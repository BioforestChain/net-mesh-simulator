(function(t){function e(e){for(var s,a,r=e[0],c=e[1],d=e[2],l=0,u=[];l<r.length;l++)a=r[l],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&u.push(i[a][0]),i[a]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);h&&h(e);while(u.length)u.shift()();return o.push.apply(o,d||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],s=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(s=!1)}s&&(o.splice(e--,1),t=r(r.s=n[0]))}return t}var s={},i={app:0},o=[];function a(t){return r.p+"js/"+({"polyfills-core-js":"polyfills-core-js","polyfills-dom":"polyfills-dom"}[t]||t)+"."+{"chunk-02c995b5":"2c14f3ea","chunk-09155df3":"543d5814","chunk-09162720":"108288dc","chunk-097e0872":"d133f0bb","chunk-0e93a01c":"fba68544","chunk-1bff95de":"09ea40b9","chunk-1c4705f4":"5095f6bd","chunk-1dbc15a2":"e4d0c01a","chunk-21a76241":"554fde75","chunk-25d83ca8":"ffe9af8e","chunk-2d0a463b":"f28c3eb9","chunk-2d0c073f":"017f6960","chunk-2d0d43da":"2c3d1bd3","chunk-2d0da04a":"620f425b","chunk-2d0e5812":"bc3079e1","chunk-2d213189":"2b11f265","chunk-2d217e6a":"9d5e5387","chunk-2d218068":"a30dce4f","chunk-2d21da73":"fc26964a","chunk-2d2304d2":"72233652","chunk-2d237b00":"6f3888dd","chunk-30dd9750":"0cf742dc","chunk-37f2300e":"37730b6d","chunk-3ed29de3":"64265362","chunk-41c0f7a4":"34b5f6b9","chunk-426f2f16":"75c0524b","chunk-462c869e":"6e964af0","chunk-47245a33":"d8eb8bfe","chunk-4739acd0":"e72afcde","chunk-53b1137a":"923eeb2e","chunk-541ea42d":"c2489929","chunk-54bbd082":"69f186fb","chunk-59d4c87c":"b38071b2","chunk-5a8ac886":"fe1a1e68","chunk-5ff96a24":"4cf1b9fb","chunk-69eb8776":"f3fa074d","chunk-6d375f34":"8ed567ae","chunk-7548ca2d":"46e87979","chunk-79f1dac7":"38cef130","chunk-858cd918":"e8dadea4","chunk-8bb7f81e":"c281b37c","chunk-a9395c36":"d1600096","chunk-d0e8aa0a":"b811aa1d","chunk-d8413eac":"c1a39de5","chunk-e5275ddc":"3793c11a","chunk-eaa2b130":"841de6ef","polyfills-core-js":"12be3461","polyfills-dom":"662760da","chunk-2d2297f7":"37033212","chunk-2d0c9758":"62f099a9","chunk-2d0b33e3":"2e69defc","chunk-2d0b9074":"cf6d8bbf","chunk-2d0b9280":"50eec7ff","chunk-2d0baac9":"ecbd8a2b","chunk-2d2376e6":"a05b70ee"}[t]+".js"}function r(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var s=new Promise((function(e,s){n=i[t]=[e,s]}));e.push(n[2]=s);var o,c=document.createElement("script");c.charset="utf-8",c.timeout=120,r.nc&&c.setAttribute("nonce",r.nc),c.src=a(t);var d=new Error;o=function(e){c.onerror=c.onload=null,clearTimeout(l);var n=i[t];if(0!==n){if(n){var s=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;d.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",d.name="ChunkLoadError",d.type=s,d.request=o,n[1](d)}i[t]=void 0}};var l=setTimeout((function(){o({type:"timeout",target:c})}),12e4);c.onerror=c.onload=o,document.head.appendChild(c)}return Promise.all(e)},r.m=t,r.c=s,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var h=d;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"0623":function(t,e,n){},"45b3":function(t,e,n){var s={"./ion-icon.entry.js":["ec64","chunk-2d2304d2"]};function i(t){if(!n.o(s,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],i=e[0];return n.e(e[1]).then((function(){return n(i)}))}i.keys=function(){return Object.keys(s)},i.id="45b3",t.exports=i},"7db6":function(t,e,n){"use strict";n("0623")},"8c28":function(t,e,n){},aa55:function(t,e,n){var s={"./ion-action-sheet.entry.js":["6618","chunk-426f2f16"],"./ion-alert.entry.js":["f06c","chunk-1c4705f4"],"./ion-app_8.entry.js":["c215","chunk-53b1137a"],"./ion-avatar_3.entry.js":["cf12","chunk-59d4c87c"],"./ion-back-button.entry.js":["4b35","chunk-69eb8776"],"./ion-backdrop.entry.js":["429d","chunk-2d0c073f"],"./ion-button_2.entry.js":["4453","chunk-25d83ca8"],"./ion-card_5.entry.js":["070b","chunk-541ea42d"],"./ion-checkbox.entry.js":["dfd8","chunk-09162720"],"./ion-chip.entry.js":["430d","chunk-09155df3"],"./ion-col_3.entry.js":["6a8a","chunk-2d0da04a"],"./ion-datetime_3.entry.js":["c15b","chunk-21a76241"],"./ion-fab_3.entry.js":["dd47","chunk-3ed29de3"],"./ion-img.entry.js":["9588","chunk-2d0e5812"],"./ion-infinite-scroll_2.entry.js":["d1e5","chunk-2d21da73"],"./ion-input.entry.js":["d111","chunk-37f2300e"],"./ion-item-option_3.entry.js":["1bb3","chunk-5ff96a24"],"./ion-item_8.entry.js":["69da","chunk-5a8ac886"],"./ion-loading.entry.js":["53a5","chunk-6d375f34"],"./ion-menu_3.entry.js":["cb00","chunk-097e0872"],"./ion-modal.entry.js":["1ad0","chunk-1bff95de"],"./ion-nav_2.entry.js":["e44f","chunk-4739acd0"],"./ion-popover.entry.js":["4285","chunk-e5275ddc"],"./ion-progress-bar.entry.js":["9b72","chunk-1dbc15a2"],"./ion-radio_2.entry.js":["beb3","chunk-0e93a01c"],"./ion-range.entry.js":["719f","chunk-54bbd082"],"./ion-refresher_2.entry.js":["0a47","chunk-d8413eac"],"./ion-reorder_2.entry.js":["6672","chunk-d0e8aa0a"],"./ion-ripple-effect.entry.js":["c8da","chunk-2d218068"],"./ion-route_4.entry.js":["10e8","chunk-858cd918"],"./ion-searchbar.entry.js":["8625","chunk-a9395c36"],"./ion-segment_2.entry.js":["0c02","chunk-462c869e"],"./ion-select_3.entry.js":["d25f","chunk-79f1dac7"],"./ion-slide_2.entry.js":["05dd","chunk-2d0a463b"],"./ion-spinner.entry.js":["e11b","chunk-8bb7f81e"],"./ion-split-pane.entry.js":["aae8","chunk-2d213189"],"./ion-tab-bar_2.entry.js":["a2bb","chunk-02c995b5"],"./ion-tab_2.entry.js":["6725","chunk-47245a33"],"./ion-text.entry.js":["ed3b","chunk-30dd9750"],"./ion-textarea.entry.js":["8798","chunk-eaa2b130"],"./ion-toast.entry.js":["c1a5","chunk-41c0f7a4"],"./ion-toggle.entry.js":["bef2","chunk-7548ca2d"],"./ion-virtual-scroll.entry.js":["5fd7","chunk-2d0d43da"]};function i(t){if(!n.o(s,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],i=e[0];return n.e(e[1]).then((function(){return n(i)}))}i.keys=function(){return Object.keys(s)},i.id="aa55",t.exports=i},cd49:function(t,e,n){"use strict";n.r(e);var s=n("7a23");function i(t,e,n,i,o,a){const r=Object(s["w"])("ion-router-outlet"),c=Object(s["w"])("ion-app");return Object(s["p"])(),Object(s["e"])(c,null,{default:Object(s["C"])(()=>[Object(s["g"])(r)]),_:1})}var o=n("d867"),a=Object(s["h"])({name:"App",components:{IonApp:o["a"],IonRouterOutlet:o["q"]}});a.render=i;var r=a,c=n("bec5");const d=Object(s["E"])("data-v-758cc6aa");Object(s["s"])("data-v-758cc6aa");const l={class:"grid-container"},h=Object(s["f"])("矩阵定制面板"),u=Object(s["f"])("矩阵大小"),p=Object(s["f"])("广播方式"),f=Object(s["f"])("最大互连率"),b=Object(s["g"])("span",{slot:"end"},"%",-1),g=Object(s["f"])("最小互连率"),m=Object(s["g"])("span",{slot:"end"},"%",-1),w=Object(s["f"])("生成/重置网络"),j=Object(s["f"])("矩阵网格"),_={class:"matrixView",ref:"canvas"},v=Object(s["f"])(" 准备开始广播 "),y=Object(s["f"])(" 停止广播 "),O=Object(s["f"])(" 停止自动步进 "),k=Object(s["f"])(" 自动步进 "),P=Object(s["f"])("调试日志面板"),x={class:"log-panel"},S={class:"log-time"};Object(s["q"])();const C=d((t,e,n,i,o,a)=>{const r=Object(s["w"])("ion-title"),c=Object(s["w"])("ion-toolbar"),C=Object(s["w"])("ion-header"),I=Object(s["w"])("ion-card-title"),M=Object(s["w"])("ion-card-header"),L=Object(s["w"])("ion-label"),B=Object(s["w"])("ion-input"),D=Object(s["w"])("ion-item"),V=Object(s["w"])("ion-col"),R=Object(s["w"])("ion-select-option"),z=Object(s["w"])("ion-select"),T=Object(s["w"])("ion-row"),A=Object(s["w"])("ion-button"),E=Object(s["w"])("ion-card-content"),$=Object(s["w"])("ion-grid"),F=Object(s["w"])("ion-card"),G=Object(s["w"])("ion-icon"),N=Object(s["w"])("ion-buttons"),H=Object(s["w"])("ion-content"),Y=Object(s["w"])("ion-page");return Object(s["p"])(),Object(s["e"])(Y,null,{default:d(()=>[Object(s["g"])(C,{translucent:!0},{default:d(()=>[Object(s["g"])(c,null,{default:d(()=>[Object(s["g"])(r,null,{default:d(()=>[Object(s["f"])(Object(s["y"])(t.title),1)]),_:1})]),_:1})]),_:1}),Object(s["g"])(H,{fullscreen:!0},{default:d(()=>[Object(s["g"])("div",l,[Object(s["g"])(F,{class:"gen-ctrl"},{default:d(()=>[Object(s["g"])($,{id:"controller-panel"},{default:d(()=>[Object(s["g"])(M,null,{default:d(()=>[Object(s["g"])(I,null,{default:d(()=>[h]),_:1})]),_:1}),Object(s["g"])(E,null,{default:d(()=>[Object(s["g"])(T,null,{default:d(()=>[Object(s["g"])(V,{size:"12","size-sm":""},{default:d(()=>[Object(s["g"])(D,null,{default:d(()=>[Object(s["g"])(L,{position:"fixed"},{default:d(()=>[u]),_:1}),Object(s["g"])(B,{type:"number",modelValue:t.matrixGenOptions.edgeSize,"onUpdate:modelValue":e[1]||(e[1]=e=>t.matrixGenOptions.edgeSize=e)},null,8,["modelValue"])]),_:1})]),_:1}),Object(s["g"])(V,{size:"12","size-sm":""},{default:d(()=>[Object(s["g"])(D,null,{default:d(()=>[Object(s["g"])(L,{position:"fixed"},{default:d(()=>[p]),_:1}),Object(s["g"])(z,{modelValue:t.boardcastMatrixType,"onUpdate:modelValue":e[2]||(e[2]=e=>t.boardcastMatrixType=e)},{default:d(()=>[(Object(s["p"])(!0),Object(s["e"])(s["a"],null,Object(s["v"])(t.allBoardcastMatrixType,t=>(Object(s["p"])(),Object(s["e"])(R,{key:t[0],value:t[1]},{default:d(()=>[Object(s["f"])(Object(s["y"])(t[1]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),Object(s["g"])(V,{size:"12","size-sm":""},{default:d(()=>[Object(s["g"])(D,null,{default:d(()=>[Object(s["g"])(L,{position:"fixed"},{default:d(()=>[f]),_:1}),Object(s["g"])(B,{class:"text-right",type:"number",inputmode:"decimal",max:"100",step:"0.1",min:"1",modelValue:t.matrixGenOptions.maxConnectRate,"onUpdate:modelValue":e[3]||(e[3]=e=>t.matrixGenOptions.maxConnectRate=e)},null,8,["modelValue"]),b]),_:1}),Object(s["g"])(D,null,{default:d(()=>[Object(s["g"])(L,{position:"fixed"},{default:d(()=>[g]),_:1}),Object(s["g"])(B,{class:"text-right",type:"number",inputmode:"decimal",max:"100",step:"0.1",min:"1",modelValue:t.matrixGenOptions.minConnectRate,"onUpdate:modelValue":e[4]||(e[4]=e=>t.matrixGenOptions.minConnectRate=e)},null,8,["modelValue"]),m]),_:1})]),_:1})]),_:1}),Object(s["g"])(A,{onClick:e[5]||(e[5]=e=>t.generateNetMeshAndReander())},{default:d(()=>[w]),_:1})]),_:1})]),_:1})]),_:1}),Object(s["g"])(F,{class:"canvas-panel"},{default:d(()=>[Object(s["g"])(M,null,{default:d(()=>[Object(s["g"])(I,null,{default:d(()=>[j]),_:1})]),_:1}),Object(s["g"])(E,null,{default:d(()=>[Object(s["g"])("canvas",_,null,512),Object(s["g"])(N,{class:"controller-bar"},{default:d(()=>[t.boardcastReady?(Object(s["p"])(),Object(s["e"])(s["a"],{key:1},[Object(s["g"])(A,{fill:"outline",onClick:e[7]||(e[7]=e=>t.stepInBroadcast()),disabled:t.canStepInBroadcast},{default:d(()=>[Object(s["g"])(G,{slot:"start",icon:t.icon.playCircleOutline},null,8,["icon"]),Object(s["f"])(" 广播步进("+Object(s["y"])(t.boardcastStepCount)+") ",1)]),_:1},8,["disabled"]),Object(s["g"])(A,{fill:"outline",onClick:e[8]||(e[8]=e=>t.abortBroadcast())},{default:d(()=>[Object(s["g"])(G,{slot:"start",icon:t.icon.stopOutline},null,8,["icon"]),y]),_:1}),t.autoBoardcastStepIn?(Object(s["p"])(),Object(s["e"])(A,{key:0,fill:"outline",onClick:e[9]||(e[9]=e=>t.stopAutoBoardcastStepIn())},{default:d(()=>[Object(s["g"])(G,{slot:"start",icon:t.icon.stopCircleOutline},null,8,["icon"]),O]),_:1})):(Object(s["p"])(),Object(s["e"])(A,{key:1,fill:"outline",onClick:e[10]||(e[10]=e=>t.startAutoBoardcastStepIn()),disabled:t.canStepInBroadcast},{default:d(()=>[Object(s["g"])(G,{slot:"start",icon:t.icon.playForwardCircleOutline},null,8,["icon"]),k]),_:1},8,["disabled"]))],64)):(Object(s["p"])(),Object(s["e"])(A,{key:0,fill:"outline",onClick:e[6]||(e[6]=e=>t.prepareBroadcast())},{default:d(()=>[Object(s["g"])(G,{slot:"start",icon:t.icon.playSkipForwardCircleOutline},null,8,["icon"]),v]),_:1}))]),_:1})]),_:1})]),_:1}),Object(s["D"])(Object(s["g"])(F,{class:"logs-panel"},{default:d(()=>[Object(s["g"])(M,null,{default:d(()=>[Object(s["g"])(I,null,{default:d(()=>[P]),_:1})]),_:1}),Object(s["g"])(E,null,{default:d(()=>[Object(s["g"])("div",x,[(Object(s["p"])(!0),Object(s["e"])(s["a"],null,Object(s["v"])(t.boardcastLogs,t=>(Object(s["p"])(),Object(s["e"])("p",{class:"log-item",key:t.time},[Object(s["g"])("span",S,Object(s["y"])(t.time),1),Object(s["g"])("span",{class:["log-message","log-type-"+t.type],innerHTML:t.log},null,10,["innerHTML"])]))),128))])]),_:1})]),_:1},512),[[s["A"],t.boardcastLogs.length]])])]),_:1})]),_:1})});var I=n("7aaa"),M=n("0404"),L=n("bb15"),B=n("1ab9"),D=n("9ab4"),V=n("e009"),R=n("09f1");class z{constructor(){this._set=new Set}has(t){return this._set.has(t)}hasEvery(...t){for(const e of t)if(!this._set.has(e))return!1;return!0}hasSome(...t){for(const e of t)if(this._set.has(e))return!0;return!1}add(...t){const e=this._set.size;for(const n of t)this._set.add(n);return this._set.size-e}remove(...t){const e=this._set.size;for(const n of t)this._set.delete(n);return e-this._set.size}toggle(t,e){return void 0===e&&(e=!this||!this.has(t)),e?this.add(t):this.remove(t),e}clear(){this._set.clear()}get size(){return this._set.size}[Symbol.iterator](){return this._set[Symbol.iterator]()}entries(){return this._set.entries()}keys(){return this._set.keys()}values(){return this._set.values()}toSet(){return this._set}}class T extends Map{add(t,...e){return this._fastAdd(t,this.get(t),e)}_fastAdd(t,e,n){return e||(e=new z,this.set(t,e)),e.add(...n)}remove(t,...e){return this._fastRemove(t,this.get(t),e)}_fastRemove(t,e,n){if(!e)return 0;const s=e.remove(...n);return 0===e.size&&this.delete(t),s}contains(t,e){const n=this.get(t);return!!n&&n.has(e)}toggle(t,e,n){const s=this.get(t);return void 0===n&&(n=!s||!s.has(e)),n?this._fastAdd(t,s,[e]):this._fastRemove(t,s,[e]),n}}class A extends T{constructor(){super(...arguments),this.indexes=new T}set(t,e){const n=this.get(t);if(n)for(const s of n)this.indexes.remove(s,t);for(const s of e)this.indexes.add(s,t);return super.set(t,e),this}add(t,...e){for(const n of e)this.indexes.add(n,t);return super.add(t,...e)}remove(t,...e){for(const n of e)this.indexes.remove(n,t);return super.remove(t,...e)}toggle(t,e,n){const s=super.toggle(t,e,n);return s?this.indexes.add(e,t):this.indexes.remove(e,t),s}}n("d271");class E{constructor(){this._cbs=new Set}emit(t){for(const e of this._cbs)e(t)}on(t){this._cbs.add(t)}off(t){return this._cbs.delete(t)}}class ${constructor(t,e,n,s){this._martix=t,this.startPoint=e,this.endPoint=n,this.data=s,this._init()}get currentPoint(){return this._martix.currentPoint}}class F{constructor(t){this.currentPoint=t,this.connectedPoints=new Map}addConntectedPoint(t){const e=t.toBigInt();return!this.connectedPoints.has(e)&&(this.connectedPoints.set(e,t),!0)}startMartixBroadcast(t,e,n){return new G(this,t,e,n)}}class G extends ${constructor(){super(...arguments),this.resolvedPointIds=new Map,this.rejectedPointIds=new Set,this.onSkipMinPointId=new E,this._level=1}_init(){const t=4,{currentPoint:e,endPoint:n}=this,s=e.makeVector(n),i=new Map,o=new Map,a=[],r=this._martix.currentPoint.edgeSize*Math.SQRT2,c=Math.PI;for(const b of this._martix.connectedPoints.values()){const d=Math.sqrt(b.calcDistancePow2(e)+b.calcDistancePow2(n)),l=e.makeVector(b),h=l.calcAngle(s),u=b.minPoint(t),p=u.toNumber();a[p]=u;const f={point:b,pointId:b.toBigInt(),distance:d/r,angle:h/c,minPoint:u,minPointId:p};i.set(f.pointId,f);let g=o.get(p);g||(g=[],o.set(p,g)),g.push(f)}this.allPointDetailMap=i;for(const b of o.values())b.sort((t,e)=>6*(t.angle-e.angle)+4*(t.distance-e.distance));const d=[...o.keys()].map(t=>a[t]),l=[],h=n.minPoint(t),u=e.minPoint(t),p=u.makeVector(h),f=n.edgeSize*Math.SQRT2;for(const b of d){const t=Math.sqrt(b.calcDistancePow2(e)+b.calcDistancePow2(n)),s=u.makeVector(b),i=s.calcAngle(p);l.push({minPoint:b,minPointId:b.toNumber(),minAngle:i/c,minDistance:t/f})}l.sort((t,e)=>6*(t.minAngle-e.minAngle)+4*(t.minDistance-e.minDistance)),this.allMinPointDetailMap=new Map(l.map(t=>[t.minPointId,t])),this.todoTasks=new Map(l.map(t=>[t,new Set(o.get(t.minPointId))])),this._bc=this.doBroadcast(this.todoTasks)}_hasResolved(t){const e=this.resolvedPointIds.get(t.minPointId);return!!e&&e.has(t.pointId)}resolvePoint(t){const e=this._getPointDetailByPointId(t.toBigInt());if(!e)return!1;let n=this.resolvedPointIds.get(e.minPointId);return n||(n=new Set,this.resolvedPointIds.set(e.minPointId,n)),n.add(e.pointId),!0}rejectPoint(t){return this.rejectedPointIds.add(t.toBigInt()),!0}_getPointDetailByPointId(t){return this.allPointDetailMap.get(t)}_getMinPointByMinPointId(t){return this.allMinPointDetailMap.get(t)}async*doBroadcast(t){do{let e;this._level=1;const n=new Set;for(const[s,i]of t)if(void 0!==e&&s.minDistance<=e.minDistance&&s.minAngle>=e.minAngle)this.onSkipMinPointId.emit(s.minPointId);else for(const t of i){if(this._hasResolved(t)){e=s,this.onSkipMinPointId.emit(s.minPointId);break}yield t.point,n.add(t);break}this._level=2;for(const s of t.values())for(const t of s)n.has(t)||this._hasResolved(t)||(yield t.point,n.add(t))}while(this.rejectedPointIds.size>0)}async getNextPoint(){const t=await this._bc.next();if(!t.done)return t.value}}class N{constructor(t){this.currentPoint=t,this.connectedPoints=new Map}addConntectedPoint(t){const e=t.toBigInt();return!this.connectedPoints.has(e)&&(this.connectedPoints.set(e,t),!0)}startMartixBroadcast(t,e,n){return new H(this,t,e,n)}}class H extends ${constructor(){super(...arguments),this.resolvedPointIds=new Set,this.rejectedPointIds=new Set,this.onSkipMinPointId=new E}_init(){const t=[];for(const s of this._martix.connectedPoints.values())t.push({point:s,value:s.toBigInt()});t.sort((t,e)=>Number(t.value-e.value));const e=this.currentPoint.toBigInt(),n=t.findIndex(t=>t.value>=e);if(n>0){const e=t.splice(0,n);t.push(...e)}this.allPointDetailList=t,this._bc=this.doBroadcast(t)}_hasResolved(t){return this.resolvedPointIds.has(t.value)}resolvePoint(t){return this.resolvedPointIds.add(t.toBigInt()),!0}rejectPoint(t){return this.rejectedPointIds.add(t.toBigInt()),!0}async*doBroadcast(t){do{for(const e of t)this._hasResolved(e)||(yield e.point)}while(this.rejectedPointIds.size>0)}async getNextPoint(){const t=await this._bc.next();if(!t.done)return t.value}}class Y{constructor(t,e,n){this.x=t,this.y=e,this.edgeSize=n,this.onData=new E,this.ownDatas=new Set,this.onData.on(t=>{this.ownDatas.add(t)})}toBigInt(){return void 0===this._bi&&(this._bi=BigInt(this.y)*BigInt(this.edgeSize)+BigInt(this.x)),this._bi}toNumber(){return void 0===this._n&&(this._n=this.y*this.edgeSize+this.x),this._n}toReadableString(){return`(${this.x+1},${this.y+1})`}calcDistancePow2(t){return(this.x-t.x)**2+(this.y-t.y)**2}calcDistance(t){return Math.sqrt(this.calcDistancePow2(t))}makeVector(t){return new X(t.x-this.x,t.y-this.y,this.edgeSize)}min(t){return{x:Math.floor(this.x/this.edgeSize*t),y:Math.floor(this.y/this.edgeSize*t)}}minPoint(t){const{x:e,y:n}=this.min(t);return new Y(e,n,t)}}class X extends Y{calcAngle(t){const e=this,n=t,s=e.x*n.x+e.y*n.y,i=e.length,o=n.length,a=s/(i*o);return Math.acos(a)}get length(){return void 0===this._len&&(this._len=this.calcDistance({x:0,y:0})),this._len}}class q{constructor(t,e){this.source=t,this.indexes=e,this._tokenSet=new z,this.onClassChanged=new E}add(t){const e=this._tokenSet.add(t);return e&&(this.onClassChanged.emit({mode:"add",list:[t]}),this.indexes.add(this.source,t)),e}remove(t){const e=this._tokenSet.remove(t);return e&&(this.onClassChanged.emit({mode:"remove",list:[t]}),this.indexes.remove(this.source,t)),e}toggle(t,e){const n=this._tokenSet.size,s=this._tokenSet.toggle(t,e);return this._tokenSet.size!==n&&(this.onClassChanged.emit({mode:s?"add":"remove",list:[t]}),this.indexes.toggle(this.source,t,e)),s}contains(t){return this._tokenSet.has(t)}containsSome(...t){return this._tokenSet.hasSome(...t)}containsEvery(...t){return this._tokenSet.hasEvery(...t)}find(t){for(const e of this._tokenSet)if(t(e))return e}[Symbol.iterator](){return this._tokenSet[Symbol.iterator]()}}const U="bc-count-";var W;(function(t){t["Linear"]="线性广播",t["Ripple"]="涟漪广播"})(W||(W={}));class J extends I["c"]{constructor(t,e){super(),this.peer=t,this.opts=e,this.peerView=new I["e"],this.labelView=new I["f"](""),this.meshView=new I["e"],this._showDetailFilters=(()=>{const t=new V["a"](.8);return[t]})(),this._hideDetailFilters=[],this.classList=new q(this,this.all.peerContainer_ClassNames_Indexes),this._initDraw(),this._initEvents(),this._initClass()}get all(){return this.opts.allPeerContainerList}_initDraw(){const t=this,{peer:e}=this,{allPeerContainerList:n,PEER_VIEW_FILL:s,MESH_STYLE:i,peerGroup:o,meshGroup:a,topPeerGroup:r,topMeshGroup:c}=this.opts;n[e.index]=t;const{viewBound:d,edgeSize:l}=e,{peerView:h}=this;h.beginFill(s),h.drawRoundedRect(d.left,d.top,d.width,d.height,.2*d.width),h.parentGroup=o,t.addChild(h),h.interactive=!0;const{labelView:u}=this;u.style.fontSize=.5*d.width,u.style.fill=16777215,u.visible=!1,h.addChild(u);const{meshView:p}=this;p.alpha=i.ALPHA,p.visible=!1,p.lineStyle({width:1,color:16777215,alpha:1,native:!0}),p.tint=i.FILL,p.alpha=i.ALPHA;const{centerX:f,centerY:b}=d;for(const g of e.connectedPeers.values()){p.moveTo(f,b);const{centerX:t,centerY:n}=g.viewBound,s=Math.abs(e.x-g.x),i=Math.abs(e.y-g.y);if(s<0||i<0)p.lineTo(g.viewBound.centerX,g.viewBound.centerY);else{const e=(t-f)/2,s=(n-b)/l;p.bezierCurveTo(f+e,b,t,n-s,t,n)}}p.parentGroup=a,p.blendMode=I["b"].SOFT_LIGHT,t.addChild(p)}_initEvents(){const{peerView:t}=this;t.addListener("pointerover",()=>this.classList.add("hover")),t.addListener("pointerout",()=>this.classList.remove("hover")),t.addListener("pointertap",t=>{const e=this.classList.toggle("active");if(e){const t=[...this.all.getPeerContainersByClassName("active")];if(t.length>2)for(let e=1;e<t.length;e++){const n=t[e];n!==this&&n.classList.remove("active")}}})}_initClass(){this.classList.onClassChanged.on(t=>{if(t.list.some(t=>"active"===t||"hover"===t)&&(this.classList.containsSome("active","hover")?this._showDetail():this._hideDetail()),t.list.some(t=>"boardcasted"===t)&&(this.classList.containsSome("boardcasted")?this.peerView.tint=65280:this.peerView.tint=16777215),t.list.some(t=>t.startsWith(U))){const t=this.classList.find(t=>t.startsWith(U));t?(this.labelView.visible=!0,this.labelView.text=t.slice(U.length),this.labelView.x=this.peer.viewBound.centerX-this.labelView.width/2,this.labelView.y=this.peer.viewBound.centerY-this.labelView.height/2):this.labelView.visible=!1}})}_showDetail(){const{peer:t,peerView:e,meshView:n,_showDetailFilters:s}=this,{MESH_STYLE:i,topMeshGroup:o,topPeerGroup:a,allPeerContainerList:r}=this.opts,c=this;c.cacheAsBitmap=!1,n.tint=i.HOVER_FILL,n.alpha=i.HOVER_ALPHA,n.visible=!0,n.zIndex=1,n.filters=s,n.parentGroup=o,e.filters=s,e.parentGroup=a;for(const d of t.connectedPeers.values()){const t=r[d.index];t.cacheAsBitmap=!1;const e=t.getChildAt(0);e.filters=s,e.parentGroup=a}}_hideDetail(){const{MESH_STYLE:t,meshGroup:e,peerGroup:n,allPeerContainerList:s}=this.opts,{peer:i,peerView:o,meshView:a,_hideDetailFilters:r}=this;a.tint=t.FILL,a.alpha=t.ALPHA,a.visible=!1,a.zIndex=0,a.filters=r,a.parentGroup=e,o.filters=r,o.parentGroup=n;for(const c of i.connectedPeers.values()){const t=s[c.index],e=t.getChildAt(0);e.filters=r,e.parentGroup=n}}toPoint(){if(!this._point){const t=this._point=new Y(this.peer.x,this.peer.y,this.peer.edgeSize);t.onData.on(t=>{this.classList.add("boardcasted");const e=this.classList.find(t=>t.startsWith(U));e?(this.classList.remove(e),this.classList.add(`${U}${parseInt(e.slice(U.length))+1}`)):this.classList.add(U+"1")})}return this._point}_initMatrix(t=W.Ripple){if(!this.matrix){switch(t){case W.Ripple:this.matrix=new F(this.toPoint());break;case W.Linear:this.matrix=new N(this.toPoint());break}for(const[t]of this.peer.connectedPeers)this.matrix.addConntectedPoint(this.all[t].toPoint())}return this.matrix}doBoardcast(t,e,n,s){const i=this._initMatrix(s),o=i.startMartixBroadcast(t.toPoint(),e.toPoint(),n);return o}}Object(D["b"])([R["a"],Object(D["e"])("design:type",Object),Object(D["e"])("design:paramtypes",[])],J.prototype,"all",null);class Q extends Array{constructor(){super(...arguments),this.peerContainer_ClassNames_Indexes=new A,this._emptyPcSet=new Set}getPeerContainersByClassName(t){var e;return(null===(e=this.peerContainer_ClassNames_Indexes.indexes.get(t))||void 0===e?void 0:e.toSet())||this._emptyPcSet}}class K extends I["c"]{constructor(t){super(),this.app=t,this.unitDashedLen=20,this.unitDashedSpeed=.01,this._aniFuns=[],this._aniDashLineView=new I["e"],Reflect.set(self,"dv",this),this.addChild(this._aniDashLineView);const{aniTicker:e}=this;e.add(t=>{if(this._aniFuns.length){this._aniDashLineView.clear();for(const e of this._aniFuns)e(t)}})}get aniTicker(){return this.app.ticker}drawAniDashedLine(t,e){const n=this._aniDashLineView,{unitDashedLen:s,unitDashedSpeed:i,aniTicker:o}=this,[a,r]=e,[c,d]=t,l=a-c,h=r-d,u=Math.sqrt(l**2+h**2),p=l/u*s,f=h/u*s;let b=0;const g=[{color:0,alpah:1,start:0,stop:.5}],m=t=>{n.lineStyle({color:t.color,alpha:t.alpah,width:1,native:!0})},w=t=>{for(const e of g){m(e);const t=e.stop-e.start;let s=c,i=d;for(s+=(e.start+b)%1*p,i+=(e.start+b)%1*f;(s-c)/l<=1;s+=p,i+=f){n.moveTo(s,i);let e,o=s+t*p;(c-o)/l>1?(o=a,e=r):e=i+t*f,n.lineTo(o,e)}}b+=t*i};this._aniFuns.push(w)}clear(){for(const t of this._aniFuns)this.aniTicker.remove(t);return this._aniFuns.length=0,this._aniDashLineView.clear()}}var Z=n("ff79");const tt=[{label:"Default",options:{edgeSize:15,maxConnectRate:50,minConnectRate:10}},{label:"Default",options:{edgeSize:20,maxConnectRate:5,minConnectRate:2}}];class et{constructor(t,e,n,s,i){this.index=t,this.viewBound=e,this.x=n,this.y=s,this.edgeSize=i,this.connectedPeers=new Map}connectedPeerPath(){let t="";for(const e of this.connectedPeers.values())t+=this.viewBound.p2pPath(e.viewBound)+" ";return t}}class nt{constructor(t,e,n,s){this.left=t,this.top=e,this.width=n,this.height=s}get right(){return this.left+this.width}get bottom(){return this.top+this.height}get centerX(){return this.left+this.width/2}get centerY(){return this.top+this.height/2}p2pPath(t){return`M ${this.centerX} ${this.centerY} L ${t.centerX} ${t.centerY}`}get centerXY(){return[this.centerX,this.centerY]}}const st={canvasCtrl:void 0,currentBoardcastTask:void 0};var it=Object(s["h"])({name:"Home",components:{IonContent:o["i"],IonHeader:o["k"],IonPage:o["p"],IonTitle:o["u"],IonToolbar:o["v"],IonItem:o["n"],IonInput:o["m"],IonGrid:o["j"],IonCol:o["h"],IonRow:o["r"],IonLabel:o["o"],IonButton:o["b"],IonButtons:o["c"],IonIcon:o["l"],IonCard:o["d"],IonCardHeader:o["f"],IonCardTitle:o["g"],IonCardContent:o["e"],IonSelect:o["s"],IonSelectOption:o["t"]},setup(){return{icon:{playSkipForwardCircleOutline:Z["l"],playCircleOutline:Z["j"],stopOutline:Z["r"],stopCircleOutline:Z["q"],playForwardCircleOutline:Z["k"]}}},data(){return{title:"矩阵广播效率指标模拟器",matrixGenOptions:{...tt[0].options},peerMatrix:[],canvasViewBox:{width:1e3,height:1e3},boardcastMatrixType:W.Linear,allBoardcastMatrixType:Object.entries(W),boardcastReady:!1,boardcastStepCount:0,boardcastCount:1,boardcastLogs:[],boardcastDone:!1,autoBoardcastStepIn:!1,get canStepInBroadcast(){return this.boardcastDone||this.autoBoardcastStepIn}}},created(){Reflect.set(self,"ii",this),this.generateNetMesh()},mounted(){const t=()=>{const{canvas:e}=this.$refs;if(e instanceof HTMLCanvasElement){const t=getComputedStyle(e);if(t.getPropertyValue("--ion-color-primary"))return void this.canvasRender(e)}requestAnimationFrame(t)};t()},methods:{generateNetMesh(){this.abortBroadcast();const t=performance.now(),e=[],n=this.$data.matrixGenOptions;{const{edgeSize:t}=n,s=this.$data.canvasViewBox.width,i=this.$data.canvasViewBox.height,o=Math.min(s/5,Math.max(s/t/3,s/500)),a=Math.min(i/5,Math.max(i/t/3,i/500)),r=(s-o*(t-1))/t,c=(i-a*(t-1))/t,d=r+o,l=c+a;for(let n=0;n<t;n++)for(let s=0;s<t;s++){const i=n*t+s;e[i]=new et(i,new nt(d*s,l*n,r,c),s,n,t)}}{const t=Math.ceil(n.maxConnectRate/100*(e.length-1)),s=Math.floor(n.minConnectRate/100*(e.length-1));for(let n=0;n<e.length;++n){const i=e[n],o=Math.round(s+Math.random()*(t-s));if(i.connectedPeers.size>=o)continue;const a=e.filter(e=>e!==i&&(!(e.connectedPeers.size>=t)&&!e.connectedPeers.has(n)));while(i.connectedPeers.size<o){const t=a.splice(Math.floor(Math.random()*a.length),1)[0];if(!t){if(i.connectedPeers.size<s)throw new Error("主动连接失败, 连接率达不成~~");break}i.connectedPeers.set(t.index,t),t.connectedPeers.set(i.index,i)}}}this.$data.peerMatrix=e,console.log((performance.now()-t).toFixed(4)+"ms")},canvasRender(t){const e=performance.now(),{peerMatrix:n,canvasViewBox:s,matrixGenOptions:i}=this.$data;I["g"].PREFER_ENV=I["d"].WEBGL2;const o=new I["a"]({view:t,width:s.width,height:s.height,resolution:1,backgroundAlpha:0,antialias:!0}),a=Reflect.get(self,"app");a instanceof I["a"]&&a.destroy(),Reflect.set(self,"app",o);const r=o.stage=new M["c"],c=getComputedStyle(t),d=t=>{let e=[0,0,0,1];const n=B["get"](t);if(!n)return e;const s=n.value;return"rgb"===n.model?e=s:"hsl"===n.model?e=[...L["hsl"].rgb([s[0],s[1],s[2]]),s[3]]:"hwb"===n.model&&(e=[...L["hwb"].rgb([s[0],s[1],s[2]]),s[3]]),e},l=t=>(t[0]<<16)+(t[1]<<8)+t[2],h=l(d(c.getPropertyValue("--ion-color-primary").trim()||"#f0f")),u={FILL:l(d(c.getPropertyPriority("--ion-color-secondary").trim()||"#d0d")),HOVER_FILL:16777215,ALPHA:.2,HOVER_ALPHA:.5},p=new M["a"](2,!1),f=new M["a"](1,!1),b=new M["a"](4,!1),g=new M["a"](3,!1),m=new M["a"](6,!1);r.sortableChildren=!0,r.addChild(new M["b"](p)),r.addChild(new M["b"](f)),r.addChild(new M["b"](b)),r.addChild(new M["b"](g)),r.addChild(new M["b"](m));const w=new Q,j={allPeerContainerList:w,PEER_VIEW_FILL:h,MESH_STYLE:u,peerGroup:p,meshGroup:f,topPeerGroup:g,topMeshGroup:b};for(const v of n){const t=new J(v,j);r.addChild(t)}const _=new K(o);_.parentGroup=m,r.addChild(_),o.ticker.maxFPS=30,console.log(I["g"].TARGET_FPMS,(performance.now()-e).toFixed(4)+"ms"),st.canvasCtrl={allPc:w,debugView:_}},generateNetMeshAndReander(){this.generateNetMesh(),this.canvasRender(this.$refs.canvas)},async alert(t,e){const n=await o["x"].create({header:t,message:e,buttons:["确定"]});await n.present()},async prepareBroadcast(){const t=t=>this.alert("准备广播出现异常",t);if(!st.canvasCtrl)return void t("等待初始化……");const e=st.canvasCtrl.allPc,n=e.getPeerContainersByClassName("active");if(n.size<2)return void t("没有选择足够的节点，请选择两个节点");const[s,i]=[...n],o=(new Date).toLocaleTimeString(),a=await s.doBoardcast(s,i,o,this.$data.boardcastMatrixType);s.toPoint().onData.emit(o),st.currentBoardcastTask={finishedPc:new Set,startPc:s,endPc:i,boardcastMap:new Map([[s,a]]),stepCount:0},this.$data.boardcastReady=!0,this.$data.boardcastStepCount=0,this.$data.boardcastCount=1},appendBoardcastLogs(t,e="info"){this.boardcastLogs.unshift({time:(new Date).toLocaleTimeString(),type:e,log:t}),this.boardcastLogs.length>1e3&&(this.boardcastLogs.length=1e3)},async stepInBroadcast(){const t=t=>this.alert("广播步进出现异常",t);if(!st.canvasCtrl||!st.currentBoardcastTask)return void t("还未准备开始广播");const{boardcastMatrixType:e}=this,{currentBoardcastTask:n,canvasCtrl:s}=st,{boardcastMap:i,finishedPc:o,startPc:a,endPc:r}=n,{allPc:c,debugView:d}=s,l=!1,h=++this.$data.boardcastStepCount;l&&console.group(`第${h}步`);let u=i.size;d.clear();let p=0;for(const[m,w]of i){if(o.has(m))continue;const t=m.toPoint(),n=await w.getNextPoint();if(!n){o.add(m);continue}const s=c[n.toNumber()];l&&console.log(`${t.toReadableString()} => ${n.toReadableString()}`),d.drawAniDashedLine(m.peer.viewBound.centerXY,s.peer.viewBound.centerXY);let h=i.get(s);if(h||(h=await s.doBoardcast(a,r,w.data,e),i.set(s,h)),n.onData.emit(w.data),h.resolvePoint(t),this.$data.boardcastCount++,p++,0===--u)break}let f=!1;i.size!==c.length&&0!==p||(f=this.$data.boardcastDone=!0);const b=i.size/c.length;let g="";if(f){const{edgeSize:t,minConnectRate:n,maxConnectRate:s}=this.matrixGenOptions;g=`在(${t}✖${t})的矩阵中，节点拥有${n.toFixed(2)}%~${s.toFixed(2)}%的节点覆盖率，使用[${e}]，`}this.appendBoardcastLogs(`使用了${h}步，${g}达成${(100*b).toFixed(2)}%的覆盖率，效率：${(i.size/this.$data.boardcastCount*100).toFixed(2)}%`,f?"success":"info"),l&&console.groupEnd()},startAutoBoardcastStepIn(){this.autoBoardcastStepIn=!0;const t=async()=>{await this.stepInBroadcast(),!this.boardcastDone&&this.autoBoardcastStepIn?requestAnimationFrame(t):this.stopAutoBoardcastStepIn()};t()},stopAutoBoardcastStepIn(){this.autoBoardcastStepIn=!1},abortBroadcast(){if(st.canvasCtrl){for(const t of st.canvasCtrl.allPc){t.classList.remove("boardcasted");const e=t.classList.find(t=>t.startsWith(U));e&&t.classList.remove(e)}st.currentBoardcastTask=void 0,this.$data.boardcastReady=!1,this.$data.boardcastStepCount=0,this.$data.boardcastCount=1,this.$data.boardcastDone=!1,this.$data.autoBoardcastStepIn=!1,st.canvasCtrl.debugView.clear()}}}}),ot=it;n("7db6");ot.render=C,ot.__scopeId="data-v-758cc6aa";var at=ot;const rt=[{path:"/",redirect:"/home"},{path:"/home",name:"Home",component:at}],ct=Object(c["a"])({history:Object(c["b"])(""),routes:rt});var dt=ct;n("4b63"),n("4041"),n("51ef"),n("a237"),n("e09e"),n("46e5"),n("98b6"),n("2d22"),n("66b0"),n("ce1f"),n("da82"),n("8c28");const lt=Object(s["d"])(r).use(o["w"],{mode:"ios",rippleEffect:!0,theme:"light"}).use(dt);dt.isReady().then(()=>{lt.mount("#app")})},d271:function(t,e,n){},da82:function(t,e,n){}});