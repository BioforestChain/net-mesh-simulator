(function(t){function e(e){for(var s,o,r=e[0],c=e[1],d=e[2],l=0,u=[];l<r.length;l++)o=r[l],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&u.push(i[o][0]),i[o]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);h&&h(e);while(u.length)u.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],s=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(s=!1)}s&&(a.splice(e--,1),t=r(r.s=n[0]))}return t}var s={},i={app:0},a=[];function o(t){return r.p+"js/"+({"polyfills-core-js":"polyfills-core-js","polyfills-dom":"polyfills-dom"}[t]||t)+"."+{"chunk-02c995b5":"2c14f3ea","chunk-09155df3":"543d5814","chunk-09162720":"108288dc","chunk-097e0872":"d133f0bb","chunk-0e93a01c":"fba68544","chunk-1bff95de":"09ea40b9","chunk-1c4705f4":"5095f6bd","chunk-1dbc15a2":"e4d0c01a","chunk-21a76241":"554fde75","chunk-25d83ca8":"ffe9af8e","chunk-2d0a463b":"f28c3eb9","chunk-2d0c073f":"017f6960","chunk-2d0d43da":"2c3d1bd3","chunk-2d0da04a":"620f425b","chunk-2d0e5812":"bc3079e1","chunk-2d213189":"2b11f265","chunk-2d217e6a":"9d5e5387","chunk-2d218068":"a30dce4f","chunk-2d21da73":"fc26964a","chunk-2d2304d2":"72233652","chunk-2d237b00":"6f3888dd","chunk-30dd9750":"0cf742dc","chunk-37f2300e":"37730b6d","chunk-3ed29de3":"64265362","chunk-41c0f7a4":"34b5f6b9","chunk-426f2f16":"75c0524b","chunk-462c869e":"6e964af0","chunk-47245a33":"d8eb8bfe","chunk-4739acd0":"e72afcde","chunk-53b1137a":"923eeb2e","chunk-541ea42d":"c2489929","chunk-54bbd082":"69f186fb","chunk-59d4c87c":"b38071b2","chunk-5a8ac886":"fe1a1e68","chunk-5ff96a24":"4cf1b9fb","chunk-69eb8776":"f3fa074d","chunk-6d375f34":"8ed567ae","chunk-7548ca2d":"46e87979","chunk-79f1dac7":"38cef130","chunk-858cd918":"e8dadea4","chunk-8bb7f81e":"c281b37c","chunk-a9395c36":"d1600096","chunk-d0e8aa0a":"b811aa1d","chunk-d8413eac":"c1a39de5","chunk-e5275ddc":"3793c11a","chunk-eaa2b130":"841de6ef","polyfills-core-js":"12be3461","polyfills-dom":"662760da","chunk-2d2297f7":"37033212","chunk-2d0c9758":"62f099a9","chunk-2d0b33e3":"2e69defc","chunk-2d0b9074":"cf6d8bbf","chunk-2d0b9280":"50eec7ff","chunk-2d0baac9":"ecbd8a2b","chunk-2d2376e6":"a05b70ee"}[t]+".js"}function r(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var s=new Promise((function(e,s){n=i[t]=[e,s]}));e.push(n[2]=s);var a,c=document.createElement("script");c.charset="utf-8",c.timeout=120,r.nc&&c.setAttribute("nonce",r.nc),c.src=o(t);var d=new Error;a=function(e){c.onerror=c.onload=null,clearTimeout(l);var n=i[t];if(0!==n){if(n){var s=e&&("load"===e.type?"missing":e.type),a=e&&e.target&&e.target.src;d.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",d.name="ChunkLoadError",d.type=s,d.request=a,n[1](d)}i[t]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:c})}),12e4);c.onerror=c.onload=a,document.head.appendChild(c)}return Promise.all(e)},r.m=t,r.c=s,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var h=d;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"45b3":function(t,e,n){var s={"./ion-icon.entry.js":["ec64","chunk-2d2304d2"]};function i(t){if(!n.o(s,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],i=e[0];return n.e(e[1]).then((function(){return n(i)}))}i.keys=function(){return Object.keys(s)},i.id="45b3",t.exports=i},6302:function(t,e,n){},"8c28":function(t,e,n){},"9a99":function(t,e,n){"use strict";n("6302")},aa55:function(t,e,n){var s={"./ion-action-sheet.entry.js":["6618","chunk-426f2f16"],"./ion-alert.entry.js":["f06c","chunk-1c4705f4"],"./ion-app_8.entry.js":["c215","chunk-53b1137a"],"./ion-avatar_3.entry.js":["cf12","chunk-59d4c87c"],"./ion-back-button.entry.js":["4b35","chunk-69eb8776"],"./ion-backdrop.entry.js":["429d","chunk-2d0c073f"],"./ion-button_2.entry.js":["4453","chunk-25d83ca8"],"./ion-card_5.entry.js":["070b","chunk-541ea42d"],"./ion-checkbox.entry.js":["dfd8","chunk-09162720"],"./ion-chip.entry.js":["430d","chunk-09155df3"],"./ion-col_3.entry.js":["6a8a","chunk-2d0da04a"],"./ion-datetime_3.entry.js":["c15b","chunk-21a76241"],"./ion-fab_3.entry.js":["dd47","chunk-3ed29de3"],"./ion-img.entry.js":["9588","chunk-2d0e5812"],"./ion-infinite-scroll_2.entry.js":["d1e5","chunk-2d21da73"],"./ion-input.entry.js":["d111","chunk-37f2300e"],"./ion-item-option_3.entry.js":["1bb3","chunk-5ff96a24"],"./ion-item_8.entry.js":["69da","chunk-5a8ac886"],"./ion-loading.entry.js":["53a5","chunk-6d375f34"],"./ion-menu_3.entry.js":["cb00","chunk-097e0872"],"./ion-modal.entry.js":["1ad0","chunk-1bff95de"],"./ion-nav_2.entry.js":["e44f","chunk-4739acd0"],"./ion-popover.entry.js":["4285","chunk-e5275ddc"],"./ion-progress-bar.entry.js":["9b72","chunk-1dbc15a2"],"./ion-radio_2.entry.js":["beb3","chunk-0e93a01c"],"./ion-range.entry.js":["719f","chunk-54bbd082"],"./ion-refresher_2.entry.js":["0a47","chunk-d8413eac"],"./ion-reorder_2.entry.js":["6672","chunk-d0e8aa0a"],"./ion-ripple-effect.entry.js":["c8da","chunk-2d218068"],"./ion-route_4.entry.js":["10e8","chunk-858cd918"],"./ion-searchbar.entry.js":["8625","chunk-a9395c36"],"./ion-segment_2.entry.js":["0c02","chunk-462c869e"],"./ion-select_3.entry.js":["d25f","chunk-79f1dac7"],"./ion-slide_2.entry.js":["05dd","chunk-2d0a463b"],"./ion-spinner.entry.js":["e11b","chunk-8bb7f81e"],"./ion-split-pane.entry.js":["aae8","chunk-2d213189"],"./ion-tab-bar_2.entry.js":["a2bb","chunk-02c995b5"],"./ion-tab_2.entry.js":["6725","chunk-47245a33"],"./ion-text.entry.js":["ed3b","chunk-30dd9750"],"./ion-textarea.entry.js":["8798","chunk-eaa2b130"],"./ion-toast.entry.js":["c1a5","chunk-41c0f7a4"],"./ion-toggle.entry.js":["bef2","chunk-7548ca2d"],"./ion-virtual-scroll.entry.js":["5fd7","chunk-2d0d43da"]};function i(t){if(!n.o(s,t))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],i=e[0];return n.e(e[1]).then((function(){return n(i)}))}i.keys=function(){return Object.keys(s)},i.id="aa55",t.exports=i},cd49:function(t,e,n){"use strict";n.r(e);var s=n("7a23");function i(t,e,n,i,a,o){const r=Object(s["w"])("ion-router-outlet"),c=Object(s["w"])("ion-app");return Object(s["p"])(),Object(s["e"])(c,null,{default:Object(s["C"])(()=>[Object(s["g"])(r)]),_:1})}var a=n("d867"),o=Object(s["h"])({name:"App",components:{IonApp:a["a"],IonRouterOutlet:a["q"]}});o.render=i;var r=o,c=n("bec5");const d=Object(s["E"])("data-v-0f28768f");Object(s["s"])("data-v-0f28768f");const l={class:"grid-container"},h=Object(s["f"])("矩阵定制面板"),u=Object(s["f"])("矩阵大小"),f={class:"end-tip",slot:"end"},p=Object(s["f"])("广播方式"),b=Object(s["f"])("互连率"),g=Object(s["f"])("最大"),m=Object(s["g"])("span",{slot:"end"},"%",-1),w=Object(s["f"])("最小"),_=Object(s["g"])("span",{slot:"end"},"%",-1),j=Object(s["f"])(" 生成/重置网络 "),v=Object(s["f"])("矩阵网格"),y={class:"matrixView",ref:"canvas"},O=Object(s["f"])(" 准备开始广播 "),k=Object(s["f"])(" 停止广播 "),P=Object(s["f"])(" 停止自动步进 "),x=Object(s["f"])(" 自动步进 "),I=Object(s["f"])("调试日志面板"),S={class:"log-panel"},C={class:"log-time"};Object(s["q"])();const M=d((t,e,n,i,a,o)=>{const r=Object(s["w"])("ion-title"),c=Object(s["w"])("ion-toolbar"),M=Object(s["w"])("ion-header"),B=Object(s["w"])("ion-card-title"),L=Object(s["w"])("ion-card-header"),D=Object(s["w"])("ion-label"),R=Object(s["w"])("ion-input"),V=Object(s["w"])("ion-item"),z=Object(s["w"])("ion-col"),T=Object(s["w"])("ion-select-option"),A=Object(s["w"])("ion-select"),$=Object(s["w"])("ion-row"),E=Object(s["w"])("ion-spinner"),F=Object(s["w"])("ion-button"),G=Object(s["w"])("ion-card-content"),N=Object(s["w"])("ion-grid"),H=Object(s["w"])("ion-card"),Y=Object(s["w"])("ion-icon"),q=Object(s["w"])("ion-buttons"),X=Object(s["w"])("ion-content"),U=Object(s["w"])("ion-page");return Object(s["p"])(),Object(s["e"])(U,null,{default:d(()=>[Object(s["g"])(M,{translucent:!0},{default:d(()=>[Object(s["g"])(c,null,{default:d(()=>[Object(s["g"])(r,null,{default:d(()=>[Object(s["f"])(Object(s["y"])(t.title),1)]),_:1})]),_:1})]),_:1}),Object(s["g"])(X,{fullscreen:!0},{default:d(()=>[Object(s["g"])("div",l,[Object(s["g"])(H,{class:"gen-ctrl"},{default:d(()=>[Object(s["g"])(N,{id:"controller-panel"},{default:d(()=>[Object(s["g"])(L,null,{default:d(()=>[Object(s["g"])(B,null,{default:d(()=>[h]),_:1})]),_:1}),Object(s["g"])(G,null,{default:d(()=>[Object(s["g"])($,null,{default:d(()=>[Object(s["g"])(z,{size:"12","size-lg":"6"},{default:d(()=>[Object(s["g"])(V,null,{default:d(()=>[Object(s["g"])(D,{position:"fixed"},{default:d(()=>[u]),_:1}),Object(s["g"])(R,{class:"text-right",type:"number",modelValue:t.matrixGenOptions.edgeSize,"onUpdate:modelValue":e[1]||(e[1]=e=>t.matrixGenOptions.edgeSize=e)},null,8,["modelValue"]),Object(s["g"])("span",f,"✖ "+Object(s["y"])(t.matrixGenOptions.edgeSize),1)]),_:1})]),_:1}),Object(s["g"])(z,{size:"12","size-lg":"6"},{default:d(()=>[Object(s["g"])(V,null,{default:d(()=>[Object(s["g"])(D,{position:"fixed"},{default:d(()=>[p]),_:1}),Object(s["g"])(A,{slot:"end",modelValue:t.boardcastMatrixType,"onUpdate:modelValue":e[2]||(e[2]=e=>t.boardcastMatrixType=e)},{default:d(()=>[(Object(s["p"])(!0),Object(s["e"])(s["a"],null,Object(s["v"])(t.allBoardcastMatrixType,t=>(Object(s["p"])(),Object(s["e"])(T,{key:t[0],value:t[1]},{default:d(()=>[Object(s["f"])(Object(s["y"])(t[1]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),Object(s["g"])(z,{size:"12"},{default:d(()=>[Object(s["g"])(D,null,{default:d(()=>[b]),_:1}),Object(s["g"])($,null,{default:d(()=>[Object(s["g"])(z,{"size-lg":"6"},{default:d(()=>[Object(s["g"])(V,null,{default:d(()=>[Object(s["g"])(D,{position:"fixed"},{default:d(()=>[g]),_:1}),Object(s["g"])(R,{class:"text-right",slot:"end",type:"number",inputmode:"decimal",max:"100",step:"0.1",min:"1",modelValue:t.matrixGenOptions.maxConnectRate,"onUpdate:modelValue":e[3]||(e[3]=e=>t.matrixGenOptions.maxConnectRate=e)},null,8,["modelValue"]),m]),_:1})]),_:1}),Object(s["g"])(z,{"size-lg":"6"},{default:d(()=>[Object(s["g"])(V,null,{default:d(()=>[Object(s["g"])(D,{position:"fixed"},{default:d(()=>[w]),_:1}),Object(s["g"])(R,{class:"text-right",slot:"end",type:"number",inputmode:"decimal",max:"100",step:"0.1",min:"1",modelValue:t.matrixGenOptions.minConnectRate,"onUpdate:modelValue":e[4]||(e[4]=e=>t.matrixGenOptions.minConnectRate=e)},null,8,["modelValue"]),_]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),Object(s["g"])(F,{onClick:e[5]||(e[5]=e=>t.generateNetMeshAndReander()),disabled:t.waitting.generateNetMesh},{default:d(()=>[t.waitting.generateNetMesh?(Object(s["p"])(),Object(s["e"])(E,{key:0})):(Object(s["p"])(),Object(s["e"])(s["a"],{key:1},[j],64))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),Object(s["g"])(H,{class:"canvas-panel"},{default:d(()=>[Object(s["g"])(L,null,{default:d(()=>[Object(s["g"])(B,null,{default:d(()=>[v]),_:1})]),_:1}),Object(s["g"])(G,null,{default:d(()=>[Object(s["g"])("canvas",y,null,512),Object(s["g"])(q,{class:"controller-bar"},{default:d(()=>[t.boardcastReady?(Object(s["p"])(),Object(s["e"])(s["a"],{key:1},[Object(s["g"])(F,{fill:"outline",onClick:e[7]||(e[7]=e=>t.stepInBroadcast()),disabled:t.canStepInBroadcast},{default:d(()=>[Object(s["g"])(Y,{slot:"start",icon:t.icon.playCircleOutline},null,8,["icon"]),Object(s["f"])(" 广播步进("+Object(s["y"])(t.boardcastStepCount)+") ",1)]),_:1},8,["disabled"]),Object(s["g"])(F,{fill:"outline",onClick:e[8]||(e[8]=e=>t.abortBroadcast())},{default:d(()=>[Object(s["g"])(Y,{slot:"start",icon:t.icon.stopOutline},null,8,["icon"]),k]),_:1}),t.autoBoardcastStepIn?(Object(s["p"])(),Object(s["e"])(F,{key:0,fill:"outline",onClick:e[9]||(e[9]=e=>t.stopAutoBoardcastStepIn())},{default:d(()=>[Object(s["g"])(Y,{slot:"start",icon:t.icon.stopCircleOutline},null,8,["icon"]),P]),_:1})):(Object(s["p"])(),Object(s["e"])(F,{key:1,fill:"outline",onClick:e[10]||(e[10]=e=>t.startAutoBoardcastStepIn()),disabled:t.canStepInBroadcast},{default:d(()=>[Object(s["g"])(Y,{slot:"start",icon:t.icon.playForwardCircleOutline},null,8,["icon"]),x]),_:1},8,["disabled"]))],64)):(Object(s["p"])(),Object(s["e"])(F,{key:0,fill:"outline",onClick:e[6]||(e[6]=e=>t.prepareBroadcast())},{default:d(()=>[Object(s["g"])(Y,{slot:"start",icon:t.icon.playSkipForwardCircleOutline},null,8,["icon"]),O]),_:1}))]),_:1})]),_:1})]),_:1}),Object(s["D"])(Object(s["g"])(H,{class:"logs-panel"},{default:d(()=>[Object(s["g"])(L,null,{default:d(()=>[Object(s["g"])(B,null,{default:d(()=>[I]),_:1})]),_:1}),Object(s["g"])(G,null,{default:d(()=>[Object(s["g"])("div",S,[(Object(s["p"])(!0),Object(s["e"])(s["a"],null,Object(s["v"])(t.boardcastLogs,t=>(Object(s["p"])(),Object(s["e"])("p",{class:"log-item",key:t.time},[Object(s["g"])("span",C,Object(s["y"])(t.time),1),Object(s["g"])("span",{class:["log-message","log-type-"+t.type],innerHTML:t.log},null,10,["innerHTML"])]))),128))])]),_:1})]),_:1},512),[[s["A"],t.boardcastLogs.length]])])]),_:1})]),_:1})});var B=n("7aaa"),L=n("0404"),D=n("bb15"),R=n("1ab9"),V=n("9ab4"),z=n("e009"),T=n("09f1");class A{constructor(){this._set=new Set}has(t){return this._set.has(t)}hasEvery(...t){for(const e of t)if(!this._set.has(e))return!1;return!0}hasSome(...t){for(const e of t)if(this._set.has(e))return!0;return!1}add(...t){const e=this._set.size;for(const n of t)this._set.add(n);return this._set.size-e}remove(...t){const e=this._set.size;for(const n of t)this._set.delete(n);return e-this._set.size}toggle(t,e){return void 0===e&&(e=!this||!this.has(t)),e?this.add(t):this.remove(t),e}clear(){this._set.clear()}get size(){return this._set.size}[Symbol.iterator](){return this._set[Symbol.iterator]()}entries(){return this._set.entries()}keys(){return this._set.keys()}values(){return this._set.values()}toSet(){return this._set}}class $ extends Map{add(t,...e){return this._fastAdd(t,this.get(t),e)}_fastAdd(t,e,n){return e||(e=new A,this.set(t,e)),e.add(...n)}remove(t,...e){return this._fastRemove(t,this.get(t),e)}_fastRemove(t,e,n){if(!e)return 0;const s=e.remove(...n);return 0===e.size&&this.delete(t),s}contains(t,e){const n=this.get(t);return!!n&&n.has(e)}toggle(t,e,n){const s=this.get(t);return void 0===n&&(n=!s||!s.has(e)),n?this._fastAdd(t,s,[e]):this._fastRemove(t,s,[e]),n}}class E extends ${constructor(){super(...arguments),this.indexes=new $}set(t,e){const n=this.get(t);if(n)for(const s of n)this.indexes.remove(s,t);for(const s of e)this.indexes.add(s,t);return super.set(t,e),this}add(t,...e){for(const n of e)this.indexes.add(n,t);return super.add(t,...e)}remove(t,...e){for(const n of e)this.indexes.remove(n,t);return super.remove(t,...e)}toggle(t,e,n){const s=super.toggle(t,e,n);return s?this.indexes.add(e,t):this.indexes.remove(e,t),s}}class F{constructor(){this._cbs=new Set}emit(t){for(const e of this._cbs)e(t)}on(t){this._cbs.add(t)}off(t){return this._cbs.delete(t)}}class G{constructor(t,e,n){this.x=t,this.y=e,this.edgeSize=n,this.onData=new F,this.ownDatas=new Set,this.onData.on(t=>{this.ownDatas.add(t)})}toBigInt(){return void 0===this._bi&&(this._bi=BigInt(this.y)*BigInt(this.edgeSize)+BigInt(this.x)),this._bi}toNumber(){return void 0===this._n&&(this._n=this.y*this.edgeSize+this.x),this._n}toReadableString(){return`(${this.x+1},${this.y+1})`}calcDistancePow2(t){return(this.x-t.x)**2+(this.y-t.y)**2}calcDistance(t){return Math.sqrt(this.calcDistancePow2(t))}makeVector(t){return new N(t.x-this.x,t.y-this.y,this.edgeSize)}min(t){return{x:Math.floor(this.x/this.edgeSize*t),y:Math.floor(this.y/this.edgeSize*t)}}minPoint(t){const{x:e,y:n}=this.min(t);return new G(e,n,t)}}class N extends G{calcAngle(t){const e=this,n=t,s=e.x*n.x+e.y*n.y,i=e.length,a=n.length,o=s/(i*a);return Math.acos(o)}get length(){return void 0===this._len&&(this._len=this.calcDistance({x:0,y:0})),this._len}}class H{constructor(t,e){this.source=t,this.indexes=e,this._tokenSet=new A,this.onClassChanged=new F}add(t){const e=this._tokenSet.add(t);return e&&(this.onClassChanged.emit({mode:"add",list:[t]}),this.indexes.add(this.source,t)),e}remove(t){const e=this._tokenSet.remove(t);return e&&(this.onClassChanged.emit({mode:"remove",list:[t]}),this.indexes.remove(this.source,t)),e}toggle(t,e){const n=this._tokenSet.size,s=this._tokenSet.toggle(t,e);return this._tokenSet.size!==n&&(this.onClassChanged.emit({mode:s?"add":"remove",list:[t]}),this.indexes.toggle(this.source,t,e)),s}contains(t){return this._tokenSet.has(t)}containsSome(...t){return this._tokenSet.hasSome(...t)}containsEvery(...t){return this._tokenSet.hasEvery(...t)}find(t){for(const e of this._tokenSet)if(t(e))return e}[Symbol.iterator](){return this._tokenSet[Symbol.iterator]()}}const Y="bc-count-";var q;n("d271");class X{constructor(t){this.currentPoint=t,this.connectedPoints=new Map}addConntectedPoint(t){const e=t.toBigInt();return!this.connectedPoints.has(e)&&(this.connectedPoints.set(e,t),!0)}startMartixBroadcast(t,e,n){return new this.MB_CTOR(this,t,e,n)}}class U{constructor(t,e,n,s){this._martix=t,this.startPoint=e,this.endPoint=n,this.data=s,this._init()}get currentPoint(){return this._martix.currentPoint}}class W extends X{constructor(){super(...arguments),this.MB_CTOR=J}}class J extends U{constructor(){super(...arguments),this.resolvedPointIds=new Set,this.rejectedPointIds=new Set,this.onSkipMinPointId=new F}_init(){const t=[];for(const s of this._martix.connectedPoints.values())t.push({point:s,value:s.toBigInt()});t.sort((t,e)=>Number(t.value-e.value));const e=this.currentPoint.toBigInt(),n=t.findIndex(t=>t.value>=e);if(n>0){const e=t.splice(0,n);t.push(...e)}this.allPointDetailList=t,this._bc=this.doBroadcast(t)}_hasResolved(t){return this.resolvedPointIds.has(t.value)}resolvePoint(t){return this.resolvedPointIds.add(t.toBigInt()),!0}rejectPoint(t){return this.rejectedPointIds.add(t.toBigInt()),!0}async*doBroadcast(t){do{for(const e of t)this._hasResolved(e)||(yield e.point)}while(this.rejectedPointIds.size>0)}async getNextPoint(){const t=await this._bc.next();if(!t.done)return t.value}}class Q extends X{constructor(){super(...arguments),this.MB_CTOR=Z}}function K(t,e=Math.sqrt(t.length)){const n=t.length;for(let s=0;s<e;++s){const e=Math.floor(Math.random()*n);t=t.slice(e).reverse().concat(t),t.length=n}return t}class Z extends U{constructor(){super(...arguments),this.resolvedPointIds=new Set,this.rejectedPointIds=new Set,this.onSkipMinPointId=new F}_init(){const t=K([...this._martix.connectedPoints.values()],2*Math.sqrt(this._martix.connectedPoints.size));this._bc=this.doBroadcast(t)}_hasResolved(t){return this.resolvedPointIds.has(t.toBigInt())}resolvePoint(t){return this.resolvedPointIds.add(t.toBigInt()),!0}rejectPoint(t){return this.rejectedPointIds.add(t.toBigInt()),!0}async*doBroadcast(t){do{for(const e of t)this._hasResolved(e)||(yield e)}while(this.rejectedPointIds.size>0)}async getNextPoint(){const t=await this._bc.next();if(!t.done)return t.value}}class tt extends X{constructor(){super(...arguments),this.MB_CTOR=et}}class et extends U{constructor(){super(...arguments),this.resolvedPointIds=new Map,this.rejectedPointIds=new Set,this.onSkipMinPointId=new F,this._level=1}_init(){const t=4,{currentPoint:e,endPoint:n}=this,s=e.makeVector(n),i=new Map,a=new Map,o=[],r=this._martix.currentPoint.edgeSize*Math.SQRT2,c=Math.PI;for(const b of this._martix.connectedPoints.values()){const d=Math.sqrt(b.calcDistancePow2(e)+b.calcDistancePow2(n)),l=e.makeVector(b),h=l.calcAngle(s),u=b.minPoint(t),f=u.toNumber();o[f]=u;const p={point:b,pointId:b.toBigInt(),distance:d/r,angle:h/c,minPoint:u,minPointId:f};i.set(p.pointId,p);let g=a.get(f);g||(g=[],a.set(f,g)),g.push(p)}this.allPointDetailMap=i;for(const b of a.values())b.sort((t,e)=>6*(t.angle-e.angle)+4*(t.distance-e.distance));const d=[...a.keys()].map(t=>o[t]),l=[],h=n.minPoint(t),u=e.minPoint(t),f=u.makeVector(h),p=n.edgeSize*Math.SQRT2;for(const b of d){const t=Math.sqrt(b.calcDistancePow2(e)+b.calcDistancePow2(n)),s=u.makeVector(b),i=s.calcAngle(f);l.push({minPoint:b,minPointId:b.toNumber(),minAngle:i/c,minDistance:t/p})}l.sort((t,e)=>6*(t.minAngle-e.minAngle)+4*(t.minDistance-e.minDistance)),this.allMinPointDetailMap=new Map(l.map(t=>[t.minPointId,t])),this.todoTasks=new Map(l.map(t=>[t,new Set(a.get(t.minPointId))])),this._bc=this.doBroadcast(this.todoTasks)}_hasResolved(t){const e=this.resolvedPointIds.get(t.minPointId);return!!e&&e.has(t.pointId)}resolvePoint(t){const e=this._getPointDetailByPointId(t.toBigInt());if(!e)return!1;let n=this.resolvedPointIds.get(e.minPointId);return n||(n=new Set,this.resolvedPointIds.set(e.minPointId,n)),n.add(e.pointId),!0}rejectPoint(t){return this.rejectedPointIds.add(t.toBigInt()),!0}_getPointDetailByPointId(t){return this.allPointDetailMap.get(t)}_getMinPointByMinPointId(t){return this.allMinPointDetailMap.get(t)}async*doBroadcast(t){do{let e;this._level=1;const n=new Set;for(const[s,i]of t)if(void 0!==e&&s.minDistance<=e.minDistance&&s.minAngle>=e.minAngle)this.onSkipMinPointId.emit(s.minPointId);else for(const t of i){if(this._hasResolved(t)){e=s,this.onSkipMinPointId.emit(s.minPointId);break}yield t.point,n.add(t);break}this._level=2;for(const s of t.values())for(const t of s)n.has(t)||this._hasResolved(t)||(yield t.point,n.add(t))}while(this.rejectedPointIds.size>0)}async getNextPoint(){const t=await this._bc.next();if(!t.done)return t.value}}function nt(t,e=q.Ripple){switch(e){case q.Ripple:return new tt(t);case q.Linear:return new W(t);case q.Random:return new Q(t)}}(function(t){t["Linear"]="线性广播",t["Ripple"]="涟漪广播",t["Random"]="随机广播"})(q||(q={}));class st extends B["c"]{constructor(t,e){super(),this.peer=t,this.opts=e,this.peerView=new B["e"],this.labelView=new B["f"](""),this.meshView=new B["e"],this._showDetailFilters=(()=>{const t=new z["a"](.8);return[t]})(),this._hideDetailFilters=[],this.classList=new H(this,this.all.peerContainer_ClassNames_Indexes),this._initDraw(),this._initEvents(),this._initClass()}get all(){return this.opts.allPeerContainerList}_initDraw(){const t=this,{peer:e}=this,{allPeerContainerList:n,PEER_VIEW_FILL:s,MESH_STYLE:i,peerGroup:a,meshGroup:o,topPeerGroup:r,topMeshGroup:c}=this.opts;n[e.index]=t;const{viewBound:d,edgeSize:l}=e,{peerView:h}=this;h.beginFill(s),h.drawRoundedRect(d.left,d.top,d.width,d.height,.2*d.width),h.parentGroup=a,t.addChild(h),h.interactive=!0;const{labelView:u}=this;u.style.fontSize=.5*d.width,u.style.fill=16777215,u.visible=!1,h.addChild(u);const{meshView:f}=this;f.alpha=i.ALPHA,f.visible=!1,f.lineStyle({width:1,color:16777215,alpha:1,native:!0}),f.tint=i.FILL,f.alpha=i.ALPHA;const{centerX:p,centerY:b}=d;for(const g of e.connectedPeers.values()){f.moveTo(p,b);const{centerX:t,centerY:n}=g.viewBound,s=Math.abs(e.x-g.x),i=Math.abs(e.y-g.y);if(s<0||i<0)f.lineTo(g.viewBound.centerX,g.viewBound.centerY);else{const e=(t-p)/2,s=(n-b)/l;f.bezierCurveTo(p+e,b,t,n-s,t,n)}}f.parentGroup=o,f.blendMode=B["b"].SOFT_LIGHT,t.addChild(f)}_initEvents(){const{peerView:t}=this;t.addListener("pointerover",()=>this.classList.add("hover")),t.addListener("pointerout",()=>this.classList.remove("hover")),t.addListener("pointertap",t=>{const e=this.classList.toggle("active");if(e){const t=[...this.all.getPeerContainersByClassName("active")];if(t.length>2)for(let e=1;e<t.length;e++){const n=t[e];n!==this&&n.classList.remove("active")}}})}_initClass(){this.classList.onClassChanged.on(t=>{if(t.list.some(t=>"active"===t||"hover"===t)&&(this.classList.containsSome("active","hover")?this._showDetail():this._hideDetail()),t.list.some(t=>"boardcasted"===t)&&(this.classList.containsSome("boardcasted")?this.peerView.tint=65280:this.peerView.tint=16777215),t.list.some(t=>t.startsWith(Y))){const t=this.classList.find(t=>t.startsWith(Y));t?(this.labelView.visible=!0,this.labelView.text=t.slice(Y.length),this.labelView.x=this.peer.viewBound.centerX-this.labelView.width/2,this.labelView.y=this.peer.viewBound.centerY-this.labelView.height/2):this.labelView.visible=!1}})}_showDetail(){const{peer:t,peerView:e,meshView:n,_showDetailFilters:s}=this,{MESH_STYLE:i,topMeshGroup:a,topPeerGroup:o,allPeerContainerList:r}=this.opts,c=this;c.cacheAsBitmap=!1,n.tint=i.HOVER_FILL,n.alpha=i.HOVER_ALPHA,n.visible=!0,n.zIndex=1,n.filters=s,n.parentGroup=a,e.filters=s,e.parentGroup=o;for(const d of t.connectedPeers.values()){const t=r[d.index];t.cacheAsBitmap=!1;const e=t.getChildAt(0);e.filters=s,e.parentGroup=o}}_hideDetail(){const{MESH_STYLE:t,meshGroup:e,peerGroup:n,allPeerContainerList:s}=this.opts,{peer:i,peerView:a,meshView:o,_hideDetailFilters:r}=this;o.tint=t.FILL,o.alpha=t.ALPHA,o.visible=!1,o.zIndex=0,o.filters=r,o.parentGroup=e,a.filters=r,a.parentGroup=n;for(const c of i.connectedPeers.values()){const t=s[c.index],e=t.getChildAt(0);e.filters=r,e.parentGroup=n}}toPoint(){if(!this._point){const t=this._point=new G(this.peer.x,this.peer.y,this.peer.edgeSize);t.onData.on(t=>{this.classList.add("boardcasted");const e=this.classList.find(t=>t.startsWith(Y));e?(this.classList.remove(e),this.classList.add(`${Y}${parseInt(e.slice(Y.length))+1}`)):this.classList.add(Y+"1")})}return this._point}_initMatrix(t=q.Ripple){if(!this.matrix){this.matrix=nt(this.toPoint(),t);for(const[t]of this.peer.connectedPeers)this.matrix.addConntectedPoint(this.all[t].toPoint())}return this.matrix}doBoardcast(t,e,n,s){const i=this._initMatrix(s),a=i.startMartixBroadcast(t.toPoint(),e.toPoint(),n);return a}}Object(V["b"])([T["a"],Object(V["e"])("design:type",Object),Object(V["e"])("design:paramtypes",[])],st.prototype,"all",null);class it extends Array{constructor(){super(...arguments),this.peerContainer_ClassNames_Indexes=new E,this._emptyPcSet=new Set}getPeerContainersByClassName(t){var e;return(null===(e=this.peerContainer_ClassNames_Indexes.indexes.get(t))||void 0===e?void 0:e.toSet())||this._emptyPcSet}}class at extends B["c"]{constructor(t){super(),this.app=t,this.unitDashedLen=20,this.unitDashedSpeed=.01,this._aniFuns=[],this._aniDashLineView=new B["e"],Reflect.set(self,"dv",this),this.addChild(this._aniDashLineView);const{aniTicker:e}=this;e.add(t=>{if(this._aniFuns.length){this._aniDashLineView.clear();for(const e of this._aniFuns)e(t)}})}get aniTicker(){return this.app.ticker}drawAniDashedLine(t,e){const n=this._aniDashLineView,{unitDashedLen:s,unitDashedSpeed:i,aniTicker:a}=this,[o,r]=e,[c,d]=t,l=o-c,h=r-d,u=Math.sqrt(l**2+h**2),f=l/u*s,p=h/u*s;let b=0;const g=[{color:0,alpah:1,start:0,stop:.5}],m=t=>{n.lineStyle({color:t.color,alpha:t.alpah,width:1,native:!0})},w=t=>{for(const e of g){m(e);const t=e.stop-e.start;let s=c,i=d;for(s+=(e.start+b)%1*f,i+=(e.start+b)%1*p;(s-c)/l<=1;s+=f,i+=p){n.moveTo(s,i);let e,a=s+t*f;(c-a)/l>1?(a=o,e=r):e=i+t*p,n.lineTo(a,e)}}b+=t*i};this._aniFuns.push(w)}clear(){for(const t of this._aniFuns)this.aniTicker.remove(t);return this._aniFuns.length=0,this._aniDashLineView.clear()}}var ot=n("ff79");const rt=[{label:"Default",options:{edgeSize:15,maxConnectRate:50,minConnectRate:10}},{label:"Default",options:{edgeSize:20,maxConnectRate:5,minConnectRate:2}}];class ct{constructor(t,e,n,s,i){this.index=t,this.viewBound=e,this.x=n,this.y=s,this.edgeSize=i,this.connectedPeers=new Map}connectedPeerPath(){let t="";for(const e of this.connectedPeers.values())t+=this.viewBound.p2pPath(e.viewBound)+" ";return t}}class dt{constructor(t,e,n,s){this.left=t,this.top=e,this.width=n,this.height=s}get right(){return this.left+this.width}get bottom(){return this.top+this.height}get centerX(){return this.left+this.width/2}get centerY(){return this.top+this.height/2}p2pPath(t){return`M ${this.centerX} ${this.centerY} L ${t.centerX} ${t.centerY}`}get centerXY(){return[this.centerX,this.centerY]}}const lt={canvasCtrl:void 0,currentBoardcastTask:void 0};var ht=Object(s["h"])({name:"Home",components:{IonContent:a["i"],IonHeader:a["k"],IonPage:a["p"],IonTitle:a["v"],IonToolbar:a["w"],IonItem:a["n"],IonInput:a["m"],IonGrid:a["j"],IonCol:a["h"],IonRow:a["r"],IonLabel:a["o"],IonButton:a["b"],IonButtons:a["c"],IonIcon:a["l"],IonCard:a["d"],IonCardHeader:a["f"],IonCardTitle:a["g"],IonCardContent:a["e"],IonSelect:a["s"],IonSelectOption:a["t"],IonSpinner:a["u"]},setup(){return{icon:{playSkipForwardCircleOutline:ot["l"],playCircleOutline:ot["j"],stopOutline:ot["r"],stopCircleOutline:ot["q"],playForwardCircleOutline:ot["k"]}}},data(){return{title:"矩阵广播效率指标模拟器",matrixGenOptions:{...rt[0].options},peerMatrix:[],canvasViewBox:{width:1e3,height:1e3},waitting:{generateNetMesh:!1,stepInBroadcast:!1},boardcastMatrixType:q.Linear,allBoardcastMatrixType:Object.entries(q),boardcastReady:!1,boardcastStepCount:0,boardcastCount:1,boardcastLogs:[],boardcastDone:!1,autoBoardcastStepIn:!1,get canStepInBroadcast(){return this.boardcastDone||this.autoBoardcastStepIn||this.waitting.stepInBroadcast}}},created(){Reflect.set(self,"ii",this),this.generateNetMesh()},mounted(){const t=()=>{const{canvas:e}=this.$refs;if(e instanceof HTMLCanvasElement){const t=getComputedStyle(e);if(t.getPropertyValue("--ion-color-primary"))return void this.canvasRender(e)}requestAnimationFrame(t)};t()},methods:{async generateNetMesh(){if(!this.waitting.generateNetMesh)try{this.waitting.generateNetMesh=!0,await this._generateNetMesh()}finally{this.waitting.generateNetMesh=!1}},async _generateNetMesh(){this.abortBroadcast();const t=performance.now(),e=[],n=this.$data.matrixGenOptions;{const{edgeSize:t}=n;if(t*t>1e3&&!1===await this.confirm("网络生成警告",`即将模拟${t*t}个节点，数量过多，会有性能问题，是否确定`))return!1;const s=this.$data.canvasViewBox.width,i=this.$data.canvasViewBox.height,a=Math.min(s/5,Math.max(s/t/3,s/500)),o=Math.min(i/5,Math.max(i/t/3,i/500)),r=(s-a*(t-1))/t,c=(i-o*(t-1))/t,d=r+a,l=c+o;for(let n=0;n<t;n++)for(let s=0;s<t;s++){const i=n*t+s;e[i]=new ct(i,new dt(d*s,l*n,r,c),s,n,t)}}{const t=Math.ceil(n.maxConnectRate/100*(e.length-1)),s=Math.floor(n.minConnectRate/100*(e.length-1));for(let n=0;n<e.length;++n){const i=e[n],a=Math.round(s+Math.random()*(t-s));if(i.connectedPeers.size>=a)continue;const o=e.filter(e=>e!==i&&(!(e.connectedPeers.size>=t)&&!e.connectedPeers.has(n)));while(i.connectedPeers.size<a){const t=o.splice(Math.floor(Math.random()*o.length),1)[0];if(!t){if(i.connectedPeers.size<s)return this.alert("网络生成失败","主动连接失败, 连接率达不成。建议调高最大互联率与最小互联率的差距"),!1;break}i.connectedPeers.set(t.index,t),t.connectedPeers.set(i.index,i)}}}return this.$data.peerMatrix=e,console.log((performance.now()-t).toFixed(4)+"ms"),!0},canvasRender(t){const e=performance.now(),{peerMatrix:n,canvasViewBox:s,matrixGenOptions:i}=this.$data;B["g"].PREFER_ENV=B["d"].WEBGL2;const a=new B["a"]({view:t,width:s.width,height:s.height,resolution:1,backgroundAlpha:0,antialias:!0}),o=Reflect.get(self,"app");o instanceof B["a"]&&o.destroy(),Reflect.set(self,"app",a);const r=a.stage=new L["c"],c=getComputedStyle(t),d=t=>{let e=[0,0,0,1];const n=R["get"](t);if(!n)return e;const s=n.value;return"rgb"===n.model?e=s:"hsl"===n.model?e=[...D["hsl"].rgb([s[0],s[1],s[2]]),s[3]]:"hwb"===n.model&&(e=[...D["hwb"].rgb([s[0],s[1],s[2]]),s[3]]),e},l=t=>(t[0]<<16)+(t[1]<<8)+t[2],h=l(d(c.getPropertyValue("--ion-color-primary").trim()||"#f0f")),u={FILL:l(d(c.getPropertyPriority("--ion-color-secondary").trim()||"#d0d")),HOVER_FILL:16777215,ALPHA:.2,HOVER_ALPHA:.5},f=new L["a"](2,!1),p=new L["a"](1,!1),b=new L["a"](4,!1),g=new L["a"](3,!1),m=new L["a"](6,!1);r.sortableChildren=!0,r.addChild(new L["b"](f)),r.addChild(new L["b"](p)),r.addChild(new L["b"](b)),r.addChild(new L["b"](g)),r.addChild(new L["b"](m));const w=new it,_={allPeerContainerList:w,PEER_VIEW_FILL:h,MESH_STYLE:u,peerGroup:f,meshGroup:p,topPeerGroup:g,topMeshGroup:b};for(const v of n){const t=new st(v,_);r.addChild(t)}const j=new at(a);return j.parentGroup=m,r.addChild(j),a.ticker.maxFPS=30,console.log(B["g"].TARGET_FPMS,(performance.now()-e).toFixed(4)+"ms"),lt.canvasCtrl={allPc:w,debugView:j},new Promise(t=>requestAnimationFrame(t))},async generateNetMeshAndReander(){if(!this.waitting.generateNetMesh)try{this.waitting.generateNetMesh=!0,await this._generateNetMesh()&&await this.canvasRender(this.$refs.canvas)}finally{this.waitting.generateNetMesh=!1}},async alert(t,e){const n=await a["y"].create({header:t,message:e,buttons:["确定"]});await n.present()},async confirm(t,e){const n=await a["y"].create({header:t,message:e,buttons:[{text:"取消",role:"cancel"},{text:"确定",role:"ok"}]});return await n.present(),n.onDidDismiss().then(t=>"ok"===t.role)},async prepareBroadcast(){const t=t=>this.alert("准备广播出现异常",t);if(!lt.canvasCtrl)return void t("等待初始化……");const e=lt.canvasCtrl.allPc,n=e.getPeerContainersByClassName("active");if(n.size<2)return void t("没有选择足够的节点，请选择两个节点");const[s,i]=[...n],a=(new Date).toLocaleTimeString(),o=await s.doBoardcast(s,i,a,this.$data.boardcastMatrixType);s.toPoint().onData.emit(a),lt.currentBoardcastTask={finishedPc:new Set,startPc:s,endPc:i,boardcastMap:new Map([[s,o]]),stepCount:0},this.$data.boardcastReady=!0,this.$data.boardcastStepCount=0,this.$data.boardcastCount=1},appendBoardcastLogs(t,e="info"){this.boardcastLogs.unshift({time:(new Date).toTimeString().split(" ",1)[0],type:e,log:t}),this.boardcastLogs.length>1e3&&(this.boardcastLogs.length=1e3)},async stepInBroadcast(){try{this.waitting.stepInBroadcast=!0,await this._stepInBroadcast()}finally{this.waitting.stepInBroadcast=!1}},async _stepInBroadcast(){const t=t=>this.alert("广播步进出现异常",t);if(!lt.canvasCtrl||!lt.currentBoardcastTask)return void t("还未准备开始广播");const{boardcastMatrixType:e}=this,{currentBoardcastTask:n,canvasCtrl:s}=lt,{boardcastMap:i,finishedPc:a,startPc:o,endPc:r}=n,{allPc:c,debugView:d}=s,l=!1,h=++this.$data.boardcastStepCount;l&&console.group(`第${h}步`);let u=i.size;d.clear();let f=0;for(const[m,w]of i){if(a.has(m))continue;const t=m.toPoint(),n=await w.getNextPoint();if(!n){a.add(m);continue}const s=c[n.toNumber()];l&&console.log(`${t.toReadableString()} => ${n.toReadableString()}`),d.drawAniDashedLine(m.peer.viewBound.centerXY,s.peer.viewBound.centerXY);let h=i.get(s);if(h||(h=await s.doBoardcast(o,r,w.data,e),i.set(s,h)),n.onData.emit(w.data),h.resolvePoint(t),this.$data.boardcastCount++,f++,0===--u)break}let p=!1;i.size!==c.length&&0!==f||(p=this.$data.boardcastDone=!0);const b=i.size/c.length;let g="";if(p){const{edgeSize:t,minConnectRate:n,maxConnectRate:s}=this.matrixGenOptions;g=`在(${t}✖${t})的矩阵中，节点拥有${n.toFixed(2)}%~${s.toFixed(2)}%的节点覆盖率，使用[${e}]，`}this.appendBoardcastLogs(`使用了${h}步，${g}达成${(100*b).toFixed(2)}%的覆盖率，效率：${(i.size/this.$data.boardcastCount*100).toFixed(2)}%`,p?"success":"info"),l&&console.groupEnd()},startAutoBoardcastStepIn(){this.autoBoardcastStepIn=!0;const t=async()=>{await this.stepInBroadcast(),!this.boardcastDone&&this.autoBoardcastStepIn?requestAnimationFrame(t):this.stopAutoBoardcastStepIn()};t()},stopAutoBoardcastStepIn(){this.autoBoardcastStepIn=!1},abortBroadcast(){if(lt.canvasCtrl){for(const t of lt.canvasCtrl.allPc){t.classList.remove("boardcasted");const e=t.classList.find(t=>t.startsWith(Y));e&&t.classList.remove(e)}lt.currentBoardcastTask=void 0,this.$data.boardcastReady=!1,this.$data.boardcastStepCount=0,this.$data.boardcastCount=1,this.$data.boardcastDone=!1,this.$data.autoBoardcastStepIn=!1,lt.canvasCtrl.debugView.clear()}}}}),ut=ht;n("9a99");ut.render=M,ut.__scopeId="data-v-0f28768f";var ft=ut;const pt=[{path:"/",redirect:"/home"},{path:"/home",name:"Home",component:ft}],bt=Object(c["a"])({history:Object(c["b"])(""),routes:pt});var gt=bt;n("4b63"),n("4041"),n("51ef"),n("a237"),n("e09e"),n("46e5"),n("98b6"),n("2d22"),n("66b0"),n("ce1f"),n("da82"),n("8c28");const mt=Object(s["d"])(r).use(a["x"],{mode:"ios",rippleEffect:!0,theme:"light"}).use(gt);gt.isReady().then(()=>{mt.mount("#app")})},d271:function(t,e,n){},da82:function(t,e,n){}});